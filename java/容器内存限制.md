

默认情况下，JVM的Max Heap Size是系统内存的1/4; 我们可以使用`jmap -head pid` 查看启动时的Max Heap Size

JDK版本 |	JVM参数
---|---
<8u131	|-Xms64m -Xmx128m
8u131-191 |	-XX:+UnlockExperimentalVMOptions、-XX:+UseCGroupMemoryLimitForHeap
>8u191	|-XX:UseContainerSupport（默认启用）、ActiveProcessorCount；百分比分配堆内存：MaxRAMPercentage、InitialRAMPercentage、MinRAMPercentage

> JDK8版本小于131时，启动JAVA程序时，添加参数 -Xms64m -Xmx128m；java 8u131+和java 9+版本，添加两个参数：-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap；JDK8版本高于191时，可以使用 MaxRAMPercentage，MaxRAMPercentage 值介于 0.0 到 100.0 之间，默认值为 25.0。

dockerfile中可以这样写
`ENV JAVA_OPTS="-XX:+UseContainerSupport -XX:InitialRAMPercentage=50 -XX:MaxRAMPercentage=80"`
docker 运行限制内存`docker run -m 1G`

k8s中这样设置
```
containers:
    resources:
      requests:
        memory: "512Mi"
        # cpu: "500m"
      limits:
        memory: "512Mi"
        # cpu: "500m"
    env:
      - name: JVM_OPTS
        values: -XX:MaxRAMPercentage=75.0

```


## 参考

[Java/Spring应用在k8s环境中的内存配置实践](https://segmentfault.com/a/1190000040295369)

[jdk1.8.191 JVM内存参数 InitialRAMPercentage和MinRAMPercentage](https://www.cnblogs.com/fengjian2016/p/13639411.html)

[Kubernetes_pod_javajdk_动态JVM堆内存大小限制](https://blog.51cto.com/daisywei/2697536)